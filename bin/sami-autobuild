#!/usr/bin/env sh

set -e

here=`dirname "$0"`

. $here/sami-defaults

EVENTS="-e modify -e move -e move_self -e create -e delete"
FORMAT="%w%f"

inotifywait -m -q $EVENTS --format "$FORMAT" -r "$SAMI_SOURCE_DIR" | \
while read F; do
  if echo $F | grep -qe "$SAMI_SOURCE_REGEX"; then
    sami-build
  fi
done
